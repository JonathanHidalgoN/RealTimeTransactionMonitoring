================================================================================
ğŸ¯ COMPLETE MIGRATION PLAN: AKS â†’ Container Apps
================================================================================

Project: Real-Time Financial Monitoring System
Goal: Simplify deployment for recruiter demos (click URL â†’ see working app)
Time Estimate: 4-6 hours
Cost Reduction: $120-150/mo â†’ $35-40/mo (70% savings)

================================================================================
PHASE 1: FILES TO DELETE (Remove AKS/K8s complexity)
================================================================================

ğŸ—‘ï¸ TERRAFORM MODULES
--------------------
âŒ platform/terraform/modules/aks/
   â”œâ”€â”€ main.tf
   â”œâ”€â”€ variables.tf
   â””â”€â”€ outputs.tf

ğŸ—‘ï¸ KUBERNETES MANIFESTS (entire directory)
------------------------------------------
âŒ k8s-manifest/
   â”œâ”€â”€ base/
   â”‚   â”œâ”€â”€ 00-serviceaccount.yml
   â”‚   â”œâ”€â”€ 01-namespace.yml
   â”‚   â”œâ”€â”€ 02-processor-deployment.yml
   â”‚   â”œâ”€â”€ 03-api-deployment-service.yml
   â”‚   â”œâ”€â”€ 04-simulator-deployment.yml
   â”‚   â”œâ”€â”€ 06-env-configmap.yml
   â”‚   â”œâ”€â”€ 07-api-hpa.yml
   â”‚   â”œâ”€â”€ 08-cluster-issuer.yml
   â”‚   â”œâ”€â”€ 09-api-ingress.yml
   â”‚   â””â”€â”€ kustomization.yml
   â””â”€â”€ overlays/
       â”œâ”€â”€ cloud/
       â”‚   â”œâ”€â”€ kustomization.yml
       â”‚   â””â”€â”€ cloud-configmap-patch.yaml
       â””â”€â”€ local/
           â”œâ”€â”€ kustomization.yml
           â”œâ”€â”€ external-services.yaml
           â”œâ”€â”€ local-api-secret.yaml
           â”œâ”€â”€ local-configmap-patch.yaml
           â”œâ”€â”€ local-images-patch.yaml
           â”œâ”€â”€ local-mongodb-secret.yaml
           â”œâ”€â”€ remove-cloud-resources.yaml
           â””â”€â”€ simulator-deployment-patch.yaml

ğŸ—‘ï¸ AKS/K8S DEPLOYMENT SCRIPTS
-----------------------------
âŒ scripts/cloudDeployment/install-cert-manager.sh
âŒ scripts/cloudDeployment/setup-ingress-controller.sh
âŒ scripts/generalUtils/update-k8s-manifests.sh
âŒ scripts/generalUtils/update-configmap.sh
âŒ scripts/generalUtils/cost-management.sh (AKS-specific)
âŒ scripts/generalUtils/restart-workload-identity.sh
âŒ scripts/generalUtils/switch-architecture.sh (old migration script)
âŒ scripts/localDevelopmentAutomation/apply-k8s-individual.sh

ğŸ—‘ï¸ MAKEFILE
-----------
âŒ Makefile (current 200+ line AKS-focused version)
   - Will be replaced with simplified 50-line version

================================================================================
PHASE 2: FILES TO CREATE
================================================================================

âœ… NEW TERRAFORM MODULE: Container Apps
---------------------------------------
âœ… platform/terraform/modules/container-apps/
   â”œâ”€â”€ main.tf              # Container Apps Environment + 3 apps
   â”œâ”€â”€ variables.tf         # Input variables
   â””â”€â”€ outputs.tf           # API URL, processor URL

   Content: Container Apps Environment, API app, Processor app, Simulator app
   Features: Auto-scaling (0-3 replicas), managed identity, HTTPS ingress

âœ… NEW TERRAFORM MODULE: Static Web App
---------------------------------------
âœ… platform/terraform/modules/static-web-app/
   â”œâ”€â”€ main.tf              # Static Web Apps resource
   â”œâ”€â”€ variables.tf         # Input variables
   â””â”€â”€ outputs.tf           # Frontend URL

   Content: Azure Static Web Apps for Blazor WebAssembly
   Features: Free tier, auto HTTPS, global CDN

âœ… SIMPLIFIED DEPLOYMENT SCRIPTS
--------------------------------
âœ… scripts/cloudDeployment/deploy-container-apps.sh
   - Simple script to trigger container app deployments
   - Restart apps if needed

âœ… scripts/cloudDeployment/build-and-push-images.sh (simplified version)
   - Build Docker images
   - Push to ACR
   - No kubectl/K8s references

âœ… NEW MAKEFILE (simplified)
---------------------------
âœ… Makefile (30-50 lines, simple and clean)
   Commands:
   - make deploy     â†’ Deploy everything to Azure
   - make destroy    â†’ Destroy Azure infrastructure
   - make dev        â†’ Start local docker-compose
   - make logs       â†’ View application logs
   - make status     â†’ Check deployment status
   - make test       â†’ Run tests

âœ… NEW GITHUB WORKFLOW (optional)
---------------------------------
âœ… .github/workflows/deploy-container-apps.yml
   - CI/CD for Container Apps deployment
   - Simpler than AKS deployment

================================================================================
PHASE 3: FILES TO MODIFY
================================================================================

ğŸ“ TERRAFORM ENVIRONMENT CONFIG
-------------------------------
ğŸ“ platform/terraform/environments/dev/main.tf
   Changes:
   - Remove: module "aks_cluster"
   + Add: module "container_apps"
   + Add: module "static_web_app"
   - Update: Pass ACR outputs to container apps module
   - Update: Pass shared resources to modules

ğŸ“ TERRAFORM VARIABLES
---------------------
ğŸ“ platform/terraform/environments/dev/variables.tf
   Changes:
   - Remove: enable_cost_optimization (not needed)
   - Remove: alert_email_addresses (simplify)
   + Keep: everything else (resource_prefix, azure_location, etc.)

ğŸ“ TERRAFORM OUTPUTS
-------------------
ğŸ“ platform/terraform/environments/dev/outputs.tf
   Changes:
   - Remove: AKS cluster outputs (cluster_name, kubeconfig, etc.)
   + Add: output "api_url" { value = module.container_apps.api_url }
   + Add: output "processor_url" { value = module.container_apps.processor_url }
   + Add: output "frontend_url" { value = module.static_web_app.default_hostname }

ğŸ“ SECURITY MODULE (minor updates)
----------------------------------
ğŸ“ platform/terraform/modules/security/main.tf
   Changes:
   - Remove: AKS workload identity role assignments
   - Remove: Federated identity credentials
   + Keep: Key Vault, managed identities
   + Add: Container Apps managed identity role assignments (if needed)

ğŸ“ COSMOS MODULE (minimal changes)
----------------------------------
ğŸ“ platform/terraform/modules/cosmos/main.tf
   Changes:
   + Add: Role assignment for Container Apps managed identity
   - Keep: Everything else the same

ğŸ“ MONITORING MODULE
--------------------
ğŸ“ platform/terraform/modules/monitoring/main.tf
   Changes:
   - Remove: aks_cluster_id input variable
   + Add: container_apps_environment_id input variable
   - Update: Monitoring queries/dashboards

ğŸ“ DEPLOYMENT SCRIPTS
---------------------
ğŸ“ scripts/cloudDeployment/bootstrap.sh
   Changes:
   - Simplify: Remove AKS-specific steps
   - Remove: kubectl installation
   - Remove: AKS credentials setup

ğŸ“ scripts/cloudDeployment/setup_app_config.sh
   Changes:
   - Remove: kubectl/kubeconfig setup
   - Remove: Workload Identity federation
   - Simplify: Focus on ACR and basic config

ğŸ“ scripts/cloudDeployment/build-and-push-acr.sh
   Changes:
   - Keep mostly the same (ACR still used)
   - Remove: Any kubectl apply commands

ğŸ“ scripts/cloudDeployment/deploy-blazor-static-app.sh
   Changes:
   - Update: Use new Static Web App outputs from Terraform
   - Simplify: Direct deployment to Static Web Apps

ğŸ“ APPLICATION CODE (MINIMAL/NO CHANGES!)
-----------------------------------------
ğŸ“ src/FinancialMonitoring.Api/         âœ… No changes needed
ğŸ“ src/TransactionProcessor/            âœ… No changes needed
ğŸ“ src/TransactionSimulator/            âœ… No changes needed
ğŸ“ src/FinancialMonitoring.WebApp/      ğŸ“ Minor: Update API URL config

ğŸ“ DOCKER COMPOSE (improve for local dev)
-----------------------------------------
ğŸ“ docker-compose.yml
   Changes:
   + Improve: Better healthchecks
   + Improve: Clearer service dependencies
   + Optional: Add Blazor WebApp service

ğŸ“ DOCUMENTATION
----------------
ğŸ“ README.md
   Changes:
   - Update: Architecture diagrams (remove AKS, add Container Apps)
   - Update: Deployment instructions
   - Update: Cost estimates ($120/mo â†’ $35/mo)
   - Update: Benefits section (emphasize simplicity)

ğŸ“ docs/deployment.md (if exists)
   Changes:
   - Complete rewrite: Simplified deployment guide
   - One command deployment: ./platform/deploy.sh -e dev
   - Remove: All kubectl/K8s references

ğŸ“ ENVIRONMENT VARIABLES
------------------------
ğŸ“ .env.example
   Changes:
   - Remove: AKS_CLUSTER_NAME
   - Remove: KAFKA-related (keep for local docker-compose only)
   + Add: CONTAINER_APPS_ENVIRONMENT (optional)
   + Keep: All Azure resource configs

================================================================================
PHASE 4: DETAILED FILE CONTENTS
================================================================================

The following section contains template code for key new files.
See full implementation details in the detailed plan or ask for specific files.

Key files to implement:
1. platform/terraform/modules/container-apps/main.tf (Container Apps resources)
2. platform/terraform/modules/container-apps/variables.tf
3. platform/terraform/modules/container-apps/outputs.tf
4. platform/terraform/modules/static-web-app/main.tf
5. platform/terraform/modules/static-web-app/variables.tf
6. platform/terraform/modules/static-web-app/outputs.tf
7. Makefile (simplified version)
8. platform/terraform/environments/dev/main.tf (updated)

================================================================================
PHASE 5: MIGRATION STEPS (Execution Order)
================================================================================

STEP 1: BACKUP & PREPARE
-------------------------
Commands:
  git checkout -b backup-aks-architecture
  git push origin backup-aks-architecture
  git checkout main
  git checkout -b migrate-to-container-apps

STEP 2: CREATE NEW TERRAFORM MODULES
-------------------------------------
1. Create platform/terraform/modules/container-apps/ directory
   - Write main.tf (Container Apps Environment + 3 apps)
   - Write variables.tf (inputs)
   - Write outputs.tf (API/processor URLs)

2. Create platform/terraform/modules/static-web-app/ directory
   - Write main.tf (Static Web Apps resource)
   - Write variables.tf (inputs)
   - Write outputs.tf (frontend URL)

3. Test syntax:
   cd platform/terraform/modules/container-apps
   terraform fmt
   terraform validate

STEP 3: UPDATE ENVIRONMENT CONFIG
----------------------------------
1. Modify platform/terraform/environments/dev/main.tf
   - Remove module "aks_cluster" block
   - Add module "container_apps" block
   - Add module "static_web_app" block
   - Update module connections

2. Update platform/terraform/environments/dev/variables.tf
   - Remove AKS-specific variables

3. Update platform/terraform/environments/dev/outputs.tf
   - Remove AKS outputs
   - Add Container Apps outputs
   - Add Static Web App outputs

4. Test plan:
   cd platform/terraform/environments/dev
   terraform init
   terraform plan

STEP 4: UPDATE SUPPORTING FILES
--------------------------------
1. Create new simplified Makefile
2. Update scripts/cloudDeployment/bootstrap.sh
3. Update scripts/cloudDeployment/setup_app_config.sh
4. Create scripts/cloudDeployment/deploy-container-apps.sh
5. Update documentation (README.md)

STEP 5: DELETE AKS RESOURCES
-----------------------------
Commands:
  rm -rf k8s-manifest/
  rm -rf platform/terraform/modules/aks/
  rm scripts/cloudDeployment/install-cert-manager.sh
  rm scripts/cloudDeployment/setup-ingress-controller.sh
  rm scripts/generalUtils/update-k8s-manifests.sh
  rm scripts/generalUtils/update-configmap.sh
  rm scripts/generalUtils/cost-management.sh
  rm scripts/generalUtils/restart-workload-identity.sh
  rm scripts/generalUtils/switch-architecture.sh
  rm scripts/localDevelopmentAutomation/apply-k8s-individual.sh

STEP 6: DEPLOY TO AZURE
------------------------
Commands:
  cd platform
  ./deploy.sh -e dev

Expected output:
  - Container Apps Environment created
  - 3 Container Apps deployed (API, Processor, Simulator)
  - Static Web App created
  - All outputs shown (URLs)

STEP 7: UPDATE DOCUMENTATION
-----------------------------
1. Update README.md
   - New architecture diagram
   - New deployment instructions
   - New cost estimates
   - Demo URLs

2. Update deployment guide
   - Simple one-command deployment
   - Remove K8s complexity

3. Add demo URLs to project
   - Frontend: https://finmon-webapp-dev.azurewebsites.net
   - API: https://finmon-api-dev.azurecontainerapps.io

STEP 8: TEST EVERYTHING
------------------------
1. Test API health:
   curl https://finmon-api-dev.azurecontainerapps.io/health

2. Test frontend:
   Open browser: https://finmon-webapp-dev.azurewebsites.net

3. Test transaction flow:
   - Start simulator
   - Check transactions in API
   - Verify anomaly detection

4. Test local development:
   make dev
   (Verify docker-compose still works)

STEP 9: COMMIT & PUSH
---------------------
Commands:
  git add .
  git commit -m "Migrate from AKS to Container Apps

  - Remove Kubernetes complexity (manifests, scripts, AKS module)
  - Add Container Apps module for simplified deployment
  - Add Static Web App module for frontend
  - Simplify Makefile (200+ lines â†’ 50 lines)
  - Reduce deployment time (90 min â†’ 10 min)
  - Reduce monthly cost ($120 â†’ $35)
  - Enable one-click demo for recruiters

  Breaking changes:
  - Removed all K8s manifests and kubectl dependencies
  - Removed AKS-specific scripts
  - New deployment command: ./platform/deploy.sh -e dev

  Migration guide: See migration-plan.txt"

  git push origin migrate-to-container-apps

STEP 10: CREATE PULL REQUEST (optional)
----------------------------------------
Create PR from migrate-to-container-apps â†’ main
Title: "Migrate to Container Apps for simplified deployment"
Description: Link to this migration plan

================================================================================
SUMMARY STATISTICS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric              â”‚ Before (AKS)     â”‚ After (Container Apps) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Terraform files     â”‚ 19 files         â”‚ 12 files               â”‚
â”‚ Scripts             â”‚ 11 scripts       â”‚ 4 scripts              â”‚
â”‚ K8s manifests       â”‚ 13 YAML files    â”‚ 0 files                â”‚
â”‚ Deployment steps    â”‚ 8-10 manual      â”‚ 1 command              â”‚
â”‚ Deployment time     â”‚ 45-90 minutes    â”‚ 10-15 minutes          â”‚
â”‚ Monthly cost        â”‚ $120-150         â”‚ $35-40                 â”‚
â”‚ Lines of config     â”‚ ~1500 lines      â”‚ ~500 lines             â”‚
â”‚ Manual DNS setup    â”‚ YES âŒ           â”‚ NO âœ…                  â”‚
â”‚ Manual SSL certs    â”‚ YES âŒ           â”‚ NO âœ…                  â”‚
â”‚ Recruiter can demo  â”‚ NO âŒ            â”‚ YES âœ…                 â”‚
â”‚ Scale to zero       â”‚ NO âŒ            â”‚ YES âœ…                 â”‚
â”‚ Built-in HTTPS      â”‚ NO âŒ            â”‚ YES âœ…                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
BENEFITS OF MIGRATION
================================================================================

FOR RECRUITING:
âœ… Recruiter clicks URL â†’ sees working app in 2 seconds
âœ… No "sorry, it's expensive to keep running" excuses
âœ… Always available (not shut down to save costs)
âœ… Shows pragmatic architecture decisions
âœ… Demonstrates cost optimization skills

FOR DEVELOPMENT:
âœ… Deploy in 10 minutes vs 90 minutes
âœ… One command: ./platform/deploy.sh -e dev
âœ… No kubectl debugging
âœ… No certificate issues
âœ… No DNS configuration headaches

FOR INTERVIEWS:
âœ… "I migrated from AKS to Container Apps and reduced costs by 70%"
âœ… "I chose the right tool for the job - not over-engineering"
âœ… "Container Apps provides the scalability without K8s complexity"
âœ… Shows understanding of when NOT to use Kubernetes

FOR BUDGET:
âœ… $35/month â†’ Can keep running permanently
âœ… $120/month â†’ Need to shut down when not demoing
âœ… Scale to zero â†’ Pay only for actual usage
âœ… Free tier Static Web Apps â†’ $0 for frontend

================================================================================
RISKS & MITIGATION
================================================================================

RISK 1: Losing AKS knowledge demonstration
Mitigation: Keep backup branch, mention in README that you've worked with both

RISK 2: Container Apps limitations
Mitigation: For this workload, Container Apps is perfect (stateless, event-driven)

RISK 3: Migration takes longer than expected
Mitigation: Start with new modules first, test before deleting AKS

RISK 4: Breaking existing workflows
Mitigation: Update docker-compose for local dev (unchanged workflow)

================================================================================
NEXT STEPS
================================================================================

Ready to implement? Start with:

1. Create Container Apps module (main.tf, variables.tf, outputs.tf)
2. Create Static Web App module
3. Update dev environment config
4. Test terraform plan
5. Deploy!

Questions? Need specific file contents? Ask!

================================================================================
END OF MIGRATION PLAN
================================================================================
